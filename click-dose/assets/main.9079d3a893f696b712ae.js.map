{"version":3,"file":"assets/main.9079d3a893f696b712ae.js","mappings":"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","sources":["webpack://pen-click-dose-calculator/./src/lib/clickPlanner.ts","webpack://pen-click-dose-calculator/./src/index.ts"],"sourcesContent":["// --- i18n primitives ---------------------------------------------------------\nconst defaultMessages = {\n    \"err.mgPerDose\": \"mgPerDose must be > 0\",\n    \"err.clicksPerDose\": \"clicksPerDose must be > 0\",\n    \"err.volumePerDose\": \"volumePerDoseMl must be > 0\",\n    \"err.desiredMg\": \"desiredMg must be >= 0\",\n    \"err.minMax\": \"Invalid min/max clicks per set\",\n    \"warn.roundedToZero\": \"Rounded to 0 clicks.\",\n    \"warn.deltaMg\": \"Delivered dose ({delivered}) differs from requested ({requested}) by {delta}. Consider adjusting the rounding mode.\",\n    \"warn.totalBelowMin\": \"Total clicks ({total}) is below the recommended minimum of {min}. Very small sets can be unreliable.\",\n    \"warn.smallSet\": \"One or more sets are below {min} clicks; consider a different rounding mode or target.\",\n    \"warn.largeSet\": \"One or more sets exceed {max} clicks; this should not occur with the constraints.\",\n    \"warn.partitionFail\": \"Could not find a partition meeting constraints; returning a single set.\",\n};\nfunction interpolate(template, params) {\n    if (!params)\n        return template;\n    return template.replace(/\\{(\\w+)\\}/g, (_, k) => params[k] === undefined || params[k] === null ? \"\" : String(params[k]));\n}\n/**\n * Factory for a simple i18n instance.\n * - locale: Intl locale, e.g. \"en-GB\", \"es-ES\"\n * - overrides: provide your own messages for any keys you want to translate\n * - units: override unit labels if needed (\"mg\", \"ml\")\n * - numberFormat: tweak digits/formatting\n */\nexport function makeI18n(locale = \"en-GB\", overrides, units, numberFormat) {\n    const msgs = { ...defaultMessages, ...overrides };\n    const u = { mg: \"mg\", ml: \"ml\", ...units };\n    const nfMg = new Intl.NumberFormat(locale, {\n        maximumFractionDigits: 3,\n        ...(numberFormat?.mg ?? {}),\n    });\n    const nfMl = new Intl.NumberFormat(locale, {\n        maximumFractionDigits: 3,\n        ...(numberFormat?.ml ?? {}),\n    });\n    const nfInt = new Intl.NumberFormat(locale, {\n        maximumFractionDigits: 0,\n        ...(numberFormat?.integer ?? {}),\n    });\n    return {\n        locale,\n        t: (key, params) => interpolate(msgs[key] ?? key, params),\n        format: {\n            mg: (n) => `${nfMg.format(n)} ${u.mg}`,\n            ml: (n) => `${nfMl.format(n)} ${u.ml}`,\n            integer: (n) => nfInt.format(n),\n        },\n    };\n}\n// --- public API --------------------------------------------------------------\nexport function planClicks(input) {\n    const { mgPerDose, desiredMg, clicksPerDose = 60, volumePerDoseMl = 0.6, maxClicksPerSet = 60, minClicksPerSet = 10, roundingMode = \"nearest\", i18n = makeI18n(), // default English\n     } = input;\n    const warnings = [];\n    // Validation (localized)\n    if (mgPerDose <= 0)\n        throw new Error(i18n.t(\"err.mgPerDose\"));\n    if (clicksPerDose <= 0)\n        throw new Error(i18n.t(\"err.clicksPerDose\"));\n    if (volumePerDoseMl <= 0)\n        throw new Error(i18n.t(\"err.volumePerDose\"));\n    if (desiredMg < 0)\n        throw new Error(i18n.t(\"err.desiredMg\"));\n    if (minClicksPerSet <= 0 || maxClicksPerSet < minClicksPerSet) {\n        throw new Error(i18n.t(\"err.minMax\"));\n    }\n    const mgPerClick = mgPerDose / clicksPerDose;\n    const mlPerClick = volumePerDoseMl / clicksPerDose;\n    const exactClicks = desiredMg / mgPerClick;\n    function roundByMode(x, mode) {\n        switch (mode) {\n            case \"down\":\n                return Math.floor(x);\n            case \"up\":\n                return Math.ceil(x);\n            case \"nearest\":\n            default:\n                return Math.round(x);\n        }\n    }\n    let totalClicks = roundByMode(exactClicks, roundingMode);\n    if (desiredMg === 0 || totalClicks === 0) {\n        return {\n            totalClicks: 0,\n            clickSets: [],\n            totalVolumeMl: 0,\n            requestedMg: desiredMg,\n            deliveredMg: 0,\n            perClick: { mg: mgPerClick, ml: mlPerClick },\n            warnings: desiredMg === 0\n                ? warnings\n                : [...warnings, i18n.t(\"warn.roundedToZero\")],\n        };\n    }\n    const deliveredMg = totalClicks * mgPerClick;\n    const deltaMg = deliveredMg - desiredMg;\n    // If the difference is more than half a click’s mg, let user know.\n    if (Math.abs(deltaMg) > mgPerClick / 2) {\n        warnings.push(i18n.t(\"warn.deltaMg\", {\n            delivered: i18n.format.mg(deliveredMg),\n            requested: i18n.format.mg(desiredMg),\n            delta: i18n.format.mg(Math.abs(deltaMg)),\n        }));\n    }\n    if (totalClicks < minClicksPerSet) {\n        warnings.push(i18n.t(\"warn.totalBelowMin\", {\n            total: i18n.format.integer(totalClicks),\n            min: i18n.format.integer(minClicksPerSet),\n        }));\n        return {\n            totalClicks,\n            clickSets: [totalClicks],\n            totalVolumeMl: totalClicks * mlPerClick,\n            requestedMg: desiredMg,\n            deliveredMg,\n            perClick: { mg: mgPerClick, ml: mlPerClick },\n            warnings,\n        };\n    }\n    const clickSets = partitionClicksNicely(totalClicks, {\n        min: minClicksPerSet,\n        max: maxClicksPerSet,\n    });\n    if (!clickSets || clickSets.length === 0) {\n        warnings.push(i18n.t(\"warn.partitionFail\"));\n        return {\n            totalClicks,\n            clickSets: [totalClicks],\n            totalVolumeMl: totalClicks * mlPerClick,\n            requestedMg: desiredMg,\n            deliveredMg,\n            perClick: { mg: mgPerClick, ml: mlPerClick },\n            warnings,\n        };\n    }\n    if (clickSets.some((c) => c < minClicksPerSet)) {\n        warnings.push(i18n.t(\"warn.smallSet\", { min: i18n.format.integer(minClicksPerSet) }));\n    }\n    if (clickSets.some((c) => c > maxClicksPerSet)) {\n        warnings.push(i18n.t(\"warn.largeSet\", { max: i18n.format.integer(maxClicksPerSet) }));\n    }\n    return {\n        totalClicks,\n        clickSets,\n        totalVolumeMl: totalClicks * mlPerClick,\n        requestedMg: desiredMg,\n        deliveredMg,\n        perClick: { mg: mgPerClick, ml: mlPerClick },\n        warnings,\n    };\n}\n// --- partitioning internals (unchanged logic) --------------------------------\nfunction partitionClicksNicely(total, opts) {\n    const { min, max } = opts;\n    const K = Math.ceil(total / max);\n    if (K <= 0)\n        return [];\n    if (K === 1 && total >= min && total <= max)\n        return [total];\n    if (total < K * min) {\n        const altK = Math.max(1, Math.floor(total / min));\n        if (altK >= 1 && total <= altK * max && total >= altK * min) {\n            return partitionWithK(total, altK, min, max);\n        }\n    }\n    return partitionWithK(total, K, min, max);\n}\nfunction partitionWithK(total, K, min, max) {\n    const balanceWeight = 0.05;\n    const tensBonus = 2.0;\n    const fivePenalty = 1.0;\n    const nonFivePenalty = 3.0;\n    const atMinPenalty = 4.0;\n    const target = total / K;\n    function scoreValue(v) {\n        let score = balanceWeight * Math.pow(v - target, 2);\n        if (v % 10 === 0)\n            score -= tensBonus;\n        else if (v % 5 === 0)\n            score += fivePenalty;\n        else\n            score += nonFivePenalty;\n        if (v === min)\n            score += atMinPenalty;\n        return score;\n    }\n    const dp = Array.from({ length: K + 1 }, () => Array(total + 1).fill(Number.POSITIVE_INFINITY));\n    const back = Array.from({ length: K + 1 }, () => Array(total + 1).fill(-1));\n    dp[0][0] = 0;\n    for (let i = 1; i <= K; i++) {\n        const minSum = i * min;\n        const maxSum = Math.min(total, i * max);\n        for (let s = minSum; s <= maxSum; s++) {\n            const sPrevMin = (i - 1) * min;\n            const sPrevMax = Math.min(total, (i - 1) * max);\n            const vMin = Math.max(min, s - sPrevMax);\n            const vMax = Math.min(max, s - sPrevMin);\n            for (let v = vMin; v <= vMax; v++) {\n                const prevScore = dp[i - 1][s - v];\n                if (prevScore === Number.POSITIVE_INFINITY)\n                    continue;\n                const cand = prevScore + scoreValue(v);\n                if (cand < dp[i][s]) {\n                    dp[i][s] = cand;\n                    back[i][s] = v;\n                }\n            }\n        }\n    }\n    if (dp[K][total] === Number.POSITIVE_INFINITY)\n        return [];\n    const sets = new Array(K);\n    let s = total;\n    for (let i = K; i >= 1; i--) {\n        const v = back[i][s];\n        if (v < 0)\n            return [];\n        sets[i - 1] = v;\n        s -= v;\n    }\n    return sets;\n}\n","import \"./styles.css\";\nimport { planClicks, makeI18n } from \"./lib/clickPlanner\";\n// Planner constants\nconst CLICKS_PER_DOSE = 60;\nconst VOLUME_PER_DOSE_ML = 0.6;\nconst DEFAULT_LOCALE = \"en-GB\";\nconst MG_VALUES = [2.5, 5, 7.5, 10, 12.5, 15];\nconst UI_STRINGS = {\n    \"en-GB\": {\n        title: \"Pen Click Dose Calculator\",\n        haveLabel: \"I have a\",\n        wantLabel: \"I want a dose of\",\n        resultHeading: \"Result\",\n        summary: (p, t) => `(Pen: ${p}; Target: ${t})`,\n        clickSets: \"Click sets\",\n        totalVolume: \"Total volume\",\n        perClick: \"Per click\",\n        perClickDose: \"Per click dose\",\n        deliveredDose: \"Delivered dose\",\n        requested: \"requested\",\n        total: \"Total\",\n        clicks: \"clicks\",\n        disclaimer: \"This tool performs arithmetic planning only. Always follow your device’s instructions and consult a clinician or pharmacist for dosing decisions.\",\n        penWord: \"pen\",\n        ariaPen: \"Pen strength (mg per full dose)\",\n        ariaDesired: \"Desired dose (mg)\",\n        penHint: (ex) => `This is the labelled dose per full dial (e.g. ${ex}).`,\n    },\n    \"fr-FR\": {\n        title: \"Calculateur de dose par clic\",\n        haveLabel: \"J’ai un\",\n        wantLabel: \"Je veux une dose de\",\n        resultHeading: \"Résultat\",\n        summary: (p, t) => `(Stylo : ${p} ; Objectif : ${t})`,\n        clickSets: \"Ensembles de clics\",\n        totalVolume: \"Volume total\",\n        perClick: \"Par clic\",\n        perClickDose: \"Dose par clic\",\n        deliveredDose: \"Dose délivrée\",\n        requested: \"demandée\",\n        total: \"Total\",\n        clicks: \"clics\",\n        disclaimer: \"Cet outil ne fournit qu’une aide de calcul. Suivez toujours les instructions de votre appareil et demandez conseil à un professionnel de santé.\",\n        penWord: \"stylo\",\n        ariaPen: \"Force du stylo (mg par dose complète)\",\n        ariaDesired: \"Dose souhaitée (mg)\",\n        penHint: (ex) => `Ceci est la dose indiquée pour un tour complet (p. ex. ${ex}).`,\n    },\n    \"de-DE\": {\n        title: \"Klick‑Dosis‑Rechner\",\n        haveLabel: \"Ich habe einen\",\n        wantLabel: \"Ich möchte eine Dosis von\",\n        resultHeading: \"Ergebnis\",\n        summary: (p, t) => `(Pen: ${p}; Ziel: ${t})`,\n        clickSets: \"Klick‑Sets\",\n        totalVolume: \"Gesamtvolumen\",\n        perClick: \"Pro Klick\",\n        perClickDose: \"Dosis pro Klick\",\n        deliveredDose: \"Abgegebene Dosis\",\n        requested: \"gewünscht\",\n        total: \"Summe\",\n        clicks: \"Klicks\",\n        disclaimer: \"Dieses Werkzeug liefert nur eine rechnerische Planung. Befolgen Sie stets die Anweisungen Ihres Geräts und lassen Sie sich medizinisch beraten.\",\n        penWord: \"Pen\",\n        ariaPen: \"Pen‑Stärke (mg pro Volldosis)\",\n        ariaDesired: \"Gewünschte Dosis (mg)\",\n        penHint: (ex) => `Dies ist die angegebene Dosis pro voller Drehung (z. B. ${ex}).`,\n    },\n};\n// Planner warning/error messages (overrides) for FR/DE\nconst MESSAGES = {\n    \"en-GB\": {},\n    \"fr-FR\": {\n        \"err.mgPerDose\": \"mgPerDose doit être > 0\",\n        \"err.clicksPerDose\": \"clicksPerDose doit être > 0\",\n        \"err.volumePerDose\": \"volumePerDoseMl doit être > 0\",\n        \"err.desiredMg\": \"desiredMg doit être ≥ 0\",\n        \"err.minMax\": \"Plage min/max de clics invalide\",\n        \"warn.roundedToZero\": \"Arrondi à 0 clic.\",\n        \"warn.deltaMg\": \"La dose délivrée ({delivered}) diffère de la dose demandée ({requested}) de {delta}. Envisagez d'ajuster le mode d'arrondi.\",\n        \"warn.totalBelowMin\": \"Le total de clics ({total}) est inférieur au minimum recommandé de {min}. Les très petits ensembles peuvent être peu fiables.\",\n        \"warn.smallSet\": \"Un ou plusieurs ensembles sont inférieurs à {min} clics; envisagez un autre mode d'arrondi ou un autre objectif.\",\n        \"warn.largeSet\": \"Un ou plusieurs ensembles dépassent {max} clics; cela ne devrait pas se produire avec ces contraintes.\",\n        \"warn.partitionFail\": \"Impossible de trouver une partition respectant les contraintes; un seul ensemble sera utilisé.\",\n    },\n    \"de-DE\": {\n        \"err.mgPerDose\": \"mgPerDose muss > 0 sein\",\n        \"err.clicksPerDose\": \"clicksPerDose muss > 0 sein\",\n        \"err.volumePerDose\": \"volumePerDoseMl muss > 0 sein\",\n        \"err.desiredMg\": \"desiredMg muss ≥ 0 sein\",\n        \"err.minMax\": \"Ungültiger Minimal-/Maximalbereich für Klicks\",\n        \"warn.roundedToZero\": \"Auf 0 Klicks gerundet.\",\n        \"warn.deltaMg\": \"Abgegebene Dosis ({delivered}) weicht von der gewünschten ({requested}) um {delta} ab. Passen Sie ggf. den Rundungsmodus an.\",\n        \"warn.totalBelowMin\": \"Gesamtanzahl der Klicks ({total}) liegt unter dem empfohlenen Minimum von {min}. Sehr kleine Sätze können unzuverlässig sein.\",\n        \"warn.smallSet\": \"Ein oder mehrere Sätze liegen unter {min} Klicks; erwägen Sie einen anderen Rundungsmodus oder Zielwert.\",\n        \"warn.largeSet\": \"Ein oder mehrere Sätze überschreiten {max} Klicks; dies sollte mit den Vorgaben nicht vorkommen.\",\n        \"warn.partitionFail\": \"Es konnte keine gültige Aufteilung gefunden werden; es wird ein einzelner Satz verwendet.\",\n    },\n};\n// Utility to require DOM elements (non-null)\nfunction requireEl(id) {\n    const el = document.getElementById(id);\n    if (!el)\n        throw new Error(`Required element #${id} not found`);\n    return el;\n}\n// DOM handles\nconst penSelect = requireEl(\"pen-mg\");\nconst desiredSelect = requireEl(\"desired-mg\");\nconst resultEl = requireEl(\"result\");\nconst titleEl = requireEl(\"t-title\");\nconst haveLabelEl = requireEl(\"t-have\");\nconst wantLabelEl = requireEl(\"t-want\");\nconst disclaimerEl = requireEl(\"t-disclaimer\");\nconst penHintEl = requireEl(\"t-pen-hint\"); // NEW\nconst localeSwitcher = requireEl(\"locale-switcher\");\nconst copyright = document.getElementById(\"copyright-year\");\nconst formEl = requireEl(\"planner-form\");\n// Set footer year\nif (copyright) {\n    copyright.textContent = String(new Date().getFullYear());\n}\n// Locale state\nlet currentLocale = DEFAULT_LOCALE;\nlet i18n = makeI18n(currentLocale, MESSAGES[currentLocale], { ml: \"ml\" });\nlet ui = UI_STRINGS[currentLocale];\nconst HTML_LANG = {\n    \"en-GB\": \"en\",\n    \"fr-FR\": \"fr\",\n    \"de-DE\": \"de\",\n};\n// Format helper for option labels\nfunction formatMg(value) {\n    return i18n.format.mg(value);\n}\nfunction updateSelectOptionLabels() {\n    // First select: show “X mg pen” (localized “pen”)\n    for (const opt of Array.from(penSelect.options)) {\n        const v = Number(opt.value);\n        opt.textContent = `${formatMg(v)} ${ui.penWord}`;\n    }\n    // Second select: show “X mg”\n    for (const opt of Array.from(desiredSelect.options)) {\n        const v = Number(opt.value);\n        opt.textContent = formatMg(v);\n    }\n}\nfunction applyLocale(loc) {\n    currentLocale = loc;\n    i18n = makeI18n(loc, MESSAGES[loc], { ml: \"ml\" });\n    ui = UI_STRINGS[loc];\n    document.documentElement.lang = HTML_LANG[loc];\n    // Update static texts\n    titleEl.textContent = ui.title;\n    haveLabelEl.textContent = ui.haveLabel;\n    wantLabelEl.textContent = ui.wantLabel;\n    disclaimerEl.textContent = ui.disclaimer;\n    // NEW: update the pen hint with a localized example like “60 clicks”\n    const example = `${i18n.format.integer(CLICKS_PER_DOSE)} ${ui.clicks}`;\n    penHintEl.textContent = ui.penHint(example);\n    // Update aria-labels\n    penSelect.setAttribute(\"aria-label\", ui.ariaPen);\n    desiredSelect.setAttribute(\"aria-label\", ui.ariaDesired);\n    // Update option labels to use locale number formatting and localized “pen”\n    updateSelectOptionLabels();\n    // Update flag button visual state\n    for (const btn of Array.from(localeSwitcher.querySelectorAll(\"button[data-locale]\"))) {\n        const selected = btn.dataset.locale === loc;\n        btn.setAttribute(\"aria-pressed\", selected ? \"true\" : \"false\");\n        btn.classList.toggle(\"ring-2\", selected);\n        btn.classList.toggle(\"ring-indigo-600/60\", selected);\n        btn.classList.toggle(\"border-indigo-600\", selected);\n        btn.classList.toggle(\"dark:ring-indigo-500/60\", selected);\n        btn.classList.toggle(\"dark:border-indigo-500\", selected);\n    }\n    // Update document <title>\n    document.title = ui.title;\n    // Re-render the result with new language\n    render();\n}\n// Current state from selects\nfunction currentState() {\n    return {\n        penMg: Number(penSelect.value),\n        desiredMg: Number(desiredSelect.value),\n    };\n}\nfunction clear(el) {\n    while (el.firstChild)\n        el.removeChild(el.firstChild);\n}\nfunction el(tag, className, text) {\n    const node = document.createElement(tag);\n    if (className)\n        node.className = className;\n    if (text != null)\n        node.textContent = text;\n    return node;\n}\nfunction chip(text) {\n    return el(\"span\", \"inline-flex items-center rounded-md bg-zinc-100 px-2 py-0.5 text-sm font-medium text-zinc-800 ring-1 ring-inset ring-zinc-200 dark:bg-zinc-800 dark:text-zinc-100 dark:ring-zinc-700\", text);\n}\nfunction render() {\n    const { penMg, desiredMg } = currentState();\n    const plan = planClicks({\n        mgPerDose: penMg,\n        desiredMg,\n        clicksPerDose: CLICKS_PER_DOSE,\n        volumePerDoseMl: VOLUME_PER_DOSE_ML,\n        i18n,\n    });\n    clear(resultEl);\n    // Header row\n    const headerRow = el(\"div\", \"flex items-baseline gap-2 mb-3\");\n    headerRow.append(el(\"h2\", \"text-lg font-semibold\", ui.resultHeading), el(\"span\", \"text-xs text-zinc-500\", ui.summary(formatMg(penMg), formatMg(desiredMg))));\n    resultEl.append(headerRow);\n    const grid = el(\"div\", \"grid grid-cols-1 gap-2 sm:grid-cols-2\");\n    // Click sets panel\n    const setsCard = el(\"div\", \"rounded-md bg-zinc-50 p-3 dark:bg-zinc-800/50\");\n    setsCard.append(el(\"div\", \"text-sm text-zinc-600 dark:text-zinc-300\", ui.clickSets));\n    const setsLine = el(\"div\", \"mt-1 text-base font-medium\");\n    plan.clickSets.forEach((n, i) => {\n        if (i > 0)\n            setsLine.append(el(\"span\", \"mx-1 text-zinc-400\", \"+\"));\n        setsLine.append(chip(String(n)));\n    });\n    setsCard.append(setsLine);\n    setsCard.append(el(\"div\", \"text-xs text-zinc-500\", `${ui.total}: ${i18n.format.integer(plan.totalClicks)} ${ui.clicks}`));\n    // Volume panel\n    const volCard = el(\"div\", \"rounded-md bg-zinc-50 p-3 dark:bg-zinc-800/50\");\n    volCard.append(el(\"div\", \"text-sm text-zinc-600 dark:text-zinc-300\", ui.totalVolume));\n    volCard.append(el(\"div\", \"mt-1 text-base font-medium\", i18n.format.ml(plan.totalVolumeMl)));\n    volCard.append(el(\"div\", \"text-xs text-zinc-500\", `${ui.perClick}: ${i18n.format.ml(plan.perClick.ml)}; ${ui.perClickDose}: ${i18n.format.mg(plan.perClick.mg)}`));\n    grid.append(setsCard, volCard);\n    resultEl.append(grid);\n    // Delivered vs requested\n    resultEl.append(el(\"div\", \"mt-3 text-sm\", `${ui.deliveredDose}: ${i18n.format.mg(plan.deliveredMg)} (${ui.requested}: ${i18n.format.mg(plan.requestedMg)})`));\n    // Warnings\n    if (plan.warnings.length) {\n        const ul = el(\"ul\", \"mt-2 list-disc pl-5 text-sm text-amber-700 dark:text-amber-400\");\n        plan.warnings.forEach((w) => ul.append(el(\"li\", undefined, w)));\n        resultEl.append(ul);\n    }\n}\n// Locale switcher events\nlocaleSwitcher.addEventListener(\"click\", (ev) => {\n    const target = ev.target.closest(\"[data-locale]\");\n    if (!target)\n        return;\n    const loc = target.dataset.locale;\n    if (loc && loc !== currentLocale)\n        applyLocale(loc);\n});\n// Initial locale + render\napplyLocale(DEFAULT_LOCALE);\nformEl.addEventListener(\"change\", render);\n"],"names":["defaultMessages","makeI18n","locale","overrides","units","numberFormat","msgs","u","mg","ml","nfMg","Intl","NumberFormat","maximumFractionDigits","nfMl","nfInt","integer","t","key","params","template","replace","_","k","undefined","String","interpolate","format","n","partitionWithK","total","K","min","max","target","scoreValue","v","score","Math","pow","dp","Array","from","length","fill","Number","POSITIVE_INFINITY","back","i","minSum","maxSum","s","sPrevMin","sPrevMax","vMin","vMax","prevScore","cand","sets","DEFAULT_LOCALE","UI_STRINGS","title","haveLabel","wantLabel","resultHeading","summary","p","clickSets","totalVolume","perClick","perClickDose","deliveredDose","requested","clicks","disclaimer","penWord","ariaPen","ariaDesired","penHint","ex","MESSAGES","requireEl","id","el","document","getElementById","Error","penSelect","desiredSelect","resultEl","titleEl","haveLabelEl","wantLabelEl","disclaimerEl","penHintEl","localeSwitcher","copyright","formEl","textContent","Date","getFullYear","currentLocale","i18n","ui","HTML_LANG","formatMg","value","applyLocale","loc","documentElement","lang","example","setAttribute","opt","options","updateSelectOptionLabels","btn","querySelectorAll","selected","dataset","classList","toggle","render","tag","className","text","node","createElement","penMg","desiredMg","plan","input","mgPerDose","clicksPerDose","volumePerDoseMl","maxClicksPerSet","minClicksPerSet","roundingMode","warnings","mgPerClick","mlPerClick","totalClicks","x","mode","floor","ceil","round","roundByMode","totalVolumeMl","requestedMg","deliveredMg","deltaMg","abs","push","delivered","delta","opts","altK","partitionClicksNicely","some","c","planClicks","firstChild","removeChild","clear","headerRow","append","grid","setsCard","setsLine","forEach","volCard","ul","w","addEventListener","ev","closest"],"sourceRoot":""}